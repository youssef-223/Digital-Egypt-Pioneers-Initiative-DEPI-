import pandas as pd 
import numpy as np
import random
import subprocess
from google.colab import files



# Usage:
# setup_kaggle_competition('microsoft-malware-prediction')
def setup_kaggle_competition(competition_name, kaggle_json='kaggle.json'):
    # Step 1: Upload 'kaggle.json'
    print("Please upload your 'kaggle.json' file.")
    files.upload()

    # Step 2: Create Kaggle directory and copy the 'kaggle.json' file
    subprocess.run(['mkdir', '-p', '~/.kaggle'], check=True)
    subprocess.run(['cp', kaggle_json, '~/.kaggle/'], check=True)
    subprocess.run(['chmod', '600', '~/.kaggle/kaggle.json'], check=True)

    # Step 3: Download the competition dataset
    print(f"Downloading competition data for '{competition_name}' from Kaggle.")
    subprocess.run(['kaggle', 'competitions', 'download', '-c', competition_name], check=True)

    # Step 4: Unzip the dataset
    print(f"Unzipping the '{competition_name}.zip' file.")
    zip_file = f"{competition_name}.zip"
    subprocess.run(['unzip', zip_file], check=True)



# Convert numerical data to integers using downcast
def downcast_numerical(df):
    for col in df.select_dtypes(include=['float64', 'int64']).columns:
        df[col] = pd.to_numeric(df[col], downcast='integer')
    return df


# Convert categorical data to integers using Label Encoding
def encode_categorical(df):
    for col in df.select_dtypes(include=['object']).columns:
        df[col] = df[col].astype('category').cat.codes
    return df


# Usage
# random_sample = load_random_sample('train.csv', sample_size=10000)

def load_random_sample(file_path, sample_size=10000):
    # Get the number of rows in the file
    row_count = sum(1 for _ in open(file_path)) - 1  # Subtract 1 to account for the header
    
    # Generate random row numbers to skip (to achieve random sampling)
    skip_rows = sorted(random.sample(range(1, row_count + 1), row_count - sample_size))
    
    # Load the sample (skip the randomly selected rows)
    random_sample = pd.read_csv(file_path, skiprows=skip_rows)
    
    # Return the random sample
    return random_sample

